{% extends 'base_dashboard.html' %}

{% block title %}View Compaint{% endblock title %}


{% block body_content %}
{% include 'home/partials/_message.html' %}
<nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-white">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'all_complaints' %}">All Complaints</a></li>
        <li class="breadcrumb-item active" aria-current="page">View Complaint</li>
        </ol>
        </nav>

<div class="card flex-fill">

        <div class="card-body">
                <div class="titlebar d-flex bg-light mb-1  w-100 align-items-center rounded flex-wrap" >
                        <h3 class="pl-2 my-2 px-2 text-secondary rounded"> Complaint ID #{{complaint.id}}</h3> 
                <span class="badge mx-2" id="status_badge" style="font-size: .9rem;">{{complaint.complaint_status}}</span>
                <!-- <h3 class="px-2 py-2 text-right bg-white my-2 text-secondary w-25 ">Status: </h3> -->
                </div>


                <style>
                        .borderless td, .borderless th {
                        border: none;
                        margin: 0;
                        padding: .1rem .5rem;
                                }
                </style>

                <div class="complaint_details_container row justify-content-between px-1 text-dark" style="flex-wrap:wrap;">
                        <div class="container-left col-sm-5 rounded px-2" style=" height: fit-content; min-height: 20rem; position: relative;">
                                <h5 class="bg-light p-1 pl-2 rounded my-1">Customer Details</h5>
                                <div class="contents px-2  py-2">
                                        <table class=" borderless table-sm">
                                                <tbody>
                                                  <tr>
                                                    <td class="text-secondary">Customer</td>
                                                    <td>{{complaint.customer_name}}</td>
                                                  </tr>
                                                  <tr>
                                                        <td class="text-secondary">Mobile</td>
                                                        <td>{{complaint.customer_mob}}</td>
                                                </tr>
                                                  <tr>
                                                        <td class="text-secondary">Address</td>
                                                        <td>{{complaint.customer_address}}</td>
                                                </tr>
                                                  
                                                </tbody>
                                              </table>
                                              <hr  class="my-2 ">
                                              <table class="borderless">
                                                <!-- <tr>
                                                  <td class="text-secondary">Assigned To</td>
                                                  <td>{{complaint.assigned_to}}</td>
                                                </tr> -->
                                                <tr>
                                                  <td class="text-secondary">Assigned Date</td>
                                                  <td>{{complaint.assigned_date}}</td>
                                                </tr>
                                                <tr>
                                                  <td class="text-secondary">Resolved Date</td>
                                                  <td>{{complaint.resolved_date}}</td>
                                                </tr>
                                              </tbody>
                                            </table> 
                                        
                                </div>
                                <!-- <hr class="my-0"> -->
                                <div class="control_bar  bg-light  mt-2 py-2 align-items-center mx-auto  rounded" style=" width: 95%; border: 1px solid rgb(235, 234, 234); position: absolute; bottom:.5rem; left:.5rem;right:.5rem;"> 
                                        <h5 class="text-center" style="text-decoration:underline rgb(203, 203, 203);"> <strong>Complaint Status</strong></h5>
                                        <form  action = "" method = "post" class="w-100">
                                                {% csrf_token %}
                                                <div class="form_container w-100 d-flex justify-content-around">

                                                        <div class="form-check">
                                                                <input class="form-check-input cmpStatus" type="radio" name="cmpStatus" id="cmpStatus1" value = 2>
                                                                <label class="form-check-label" for="cmpStatus1">
                                                                        In Progresss
                                                                </label>
                                                        </div>
                                                        <div class="form-check">
                                                                <input class="form-check-input cmpStatus" type="radio" name="cmpStatus" id="cmpStatus2" value = 3>
                                                                <label class="form-check-label" for="cmpStatus2">
                                                                Repaired
                                                                </label>
                                                        </div>
                                                        <div class="form-check">
                                                                <input class="form-check-input cmpStatus" type="radio" name="cmpStatus" id="cmpStatus2" value = 4>
                                                                <label class="form-check-label " for="cmpStatus2">
                                                                Failed
                                                                </label>
                                                        </div>
                                                </div>
                                                <hr class="my-2">
                                                <div class="submit-btn d-flex justify-content-center">
                                                        <input  class="btn btn-primary rounded btn-sm py-1 w-25 mt-1" type = "submit" value = 'Submit' style="font-size:.9rem ;"/>
                                                </div>
                                        </form>
                                </div>
                        </div>
                        
                        <div class="container-right bg-white col-sm-7 px-2 ">
                                <h5 class="bg-light rounded my-1 p-1 pl-2">Product Details</h5>
                                <div class="contents px-2  py-2 ">

                                        <table class=" borderless">
                                                <tbody>
                                                  <tr>
                                                    <td class="text-secondary">Product</td>
                                                    <td>{{complaint.product_name}}</td>
                                                  </tr>
                                                  <tr>
                                                    <td class="text-secondary">Description</td>
                                                    <td>{{complaint.product_description}}</td>
                                                  </tr>
                                                   
                                                  <tr>
                                                    <td class="text-secondary " >Registred By</td>
                                                    <td>{{complaint.registred_by}}</td>
                                                  </tr>
                                                  <tr>
                                                    <td class="text-secondary">Registred On</td>
                                                    <td>{{complaint.registred_date}}</td>
                                                  </tr>
                                                </table>

                                                <hr  class="my-2">
                                                {% comment %} <hr> {% endcomment %}
                                                      <div class="row mx-0">
                                                        <div class="col-sm-2">
                                                            <strong class="mb-0">Problem</strong>
                                                        </div>
                                                                <div class="col-sm-10 text-secondary">
                                                                                {{complaint.problem}}
                                                                </div>
                                                </div>

                                </div>
        
                        </div>
                </div>
        </div>

        <div class="px-4">
                {% if components %}
        <div class="d-flex mt-3 justify-content-between align-items-center">
                <span  class="pl-2" style="width: 18rem; ">Parts Used </span>
                <span class="ml-2" style="height:1px; width: 90rem; background-color: lightgrey;">
                </span>
        </div>
        <div class="table-container px-2" style="overflow-x: scroll;">

                <table class="table table-sm" style="min-width:30rem;">
                <thead>
                        <tr>
                        <th width = "50">Item</th>
                        <th width = "60%">Description</th>
                        <th width = "80">Unit Price</th>
                        <th width = "50">Quantity</th>
                        <th width = "80" style="min-width:8rem ;">Action</th>
                </thead>
                
                <tbody>
                        {% for component in components %}
                        <tr>
                                <td>{{component.item_name}}</td>
                                <td>{{component.item_description}}</td>
                                <td>{{component.unit_price}}</td>
                                <td>{{component.quantity}}</td>
                                <td>
                                        <span class="d-flex">
                                                <a class="btn btn-primary btn-sm mx-2 rounded"
                                                        href="{% url 'update_component' component.id %}">Edit</a>



                                                <!-- Button trigger modal -->
                                                <button type="button" class="btn btn-danger btn-sm rounded"
                                                        data-toggle="modal" data-target="#exampleModal">
                                                        Remove
                                                </button>

                                                <!-- Modal -->
                                                <div class="modal fade" id="exampleModal" tabindex="-1"
                                                        role="dialog"
                                                        aria-labelledby="exampleModalLabel"
                                                        aria-hidden="true">
                                                        <div class="modal-dialog" role="document">
                                                                <div class="modal-content">
                                                                        <div class="modal-header">
                                                                                <h5 class="modal-title"
                                                                                        id="exampleModalLabel">
                                                                                        Are you sure want to remove?</h5>
                                                                                <button type="button"
                                                                                        class="close"
                                                                                        data-dismiss="modal"
                                                                                        aria-label="Close">
                                                                                        <span
                                                                                                aria-hidden="true">&times;</span>
                                                                                </button>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                                Item can not be recovred once deleted!
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                                <button type="button"
                                                                                        class="btn btn-secondary"
                                                                                        data-dismiss="modal">Close</button>
                                                                                                                        
                                                                                        <form action="{% url 'delete_component' component.id %}"
                                                                                        method="post">
                                                                                        {% csrf_token %}
                                                                                        <input type="submit"
                                                                                                class="btn btn-danger rounded"
                                                                                                value="Yes">
                                                                                </form>
                                                                        </div>
                                                                </div>
                                                        </div>
                                                </div>


                                        </span>
                                </td>
                        </tr>
                        {% endfor %}
                </tbody>
                </table>
                </div>

                </div>
                {% endif %}

                <div class="bottom-control mx-2 mb-3  mt-1  d-flex bg-light rounded  justify-content-center  p-0" >
                        <a  class="btn text-primary" href="{% url 'add_component' complaint.id %}">
                                <div class="" style="font-size:1rem ;">
                                        <i class="fa-solid fa-plus"></i> Add Component
                                </div>
                        </a>
                </div>
</div>


<script>
        complaint_opt  = document.getElementsByClassName("cmpStatus");
        console.log(complaint_opt)
        let cmp_selected  = "{{complaint.complaint_status}}"
        console.log(cmp_selected)
        let a =Array.from(complaint_opt);
        Array.from(complaint_opt).forEach(element => {
                if(element.value == cmp_selected){
                        element.checked = true
                }
         });
         

         let status_badge = document.getElementById("status_badge");
         let status = "{{complaint.complaint_status}}";
         if(status==2){
                status_badge.classList.add("bg-primary")
                status_badge.innerHTML = "In Progress"
         }
         else if(status==3){
                 status_badge.classList.add("bg-success")
                 status_badge.innerHTML = "Repaired"
                }
                else if(status==4){
                        status_badge.classList.add("bg-danger")
                        status_badge.innerHTML = "Failed to Repair"
                }
                else if(status==5){
                        status_badge.classList.add("bg-secondary")
                        status_badge.innerHTML = "Repaired and Closed"
                }
                else if(status==6){
                        status_badge.classList.add("bg-dark")
                        status_badge.innerHTML = "Failed and Closed"
                }
                else{
                        status_badge.classList.add("bg-warning")
                        status_badge.innerHTML = "Registred"
                }
                
                
</script>

{% endblock body_content %}
